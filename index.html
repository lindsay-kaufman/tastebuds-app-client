<!DOCTYPE html>
<html>

<head>
  <title>TasteBuds</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Do not add `link` tags-->
  <link rel="shortcut icon" type="image/x-icon" href="favicon.ico">

  <!-- Do not add `script` tags-->
  <script src="public/vendor.js" type="text/javascript" charset="utf-8" defer></script>
  <script src="public/application.js" type="text/javascript" charset="utf-8" defer></script>
  <style>
    #map {
      width: 100%;
      height: 400px;
      background-color: white;
    }

    #pac-input {
      background-color: #fff;
      font-size: 15px;
      margin-left: 12px;
      padding: 0 11px 0 13px;
      text-overflow: ellipsis;
      width: 400px
    }
  </style>

<body>
  <nav>
    <h1>TasteBuds</h1>
    <div class="fav-buttons">
      <button id="getFavoritesButton" class="btn btn-outline-light">View Your Favorites</button>
      <button id="clearFavoritesButton" class="btn btn-outline-light">Hide Favorites</button>
      <button id="exploreRestaurantsButton" class="btn btn-outline-light">Explore Our Restaurants</button>
      <button id="hideRestaurantsButton" class="btn btn-outline-light">Hide Restaurants</button>
    </div>
  </nav>

  <div class="container" id="homepage">
    <div class="row">
      <form class="input-group" id="sign-up">
        <fieldset>
          <input class="col-8 col-lg-3 mb-2 credentials" name="credentials[email]" type="email" placeholder="email" required>
          <input class="col-8 col-lg-3 mb-2 credentials" name="credentials[password]" type="password" placeholder="password" required>
          <input class="col-8 col-lg-3 mb-2 credentials" name="credentials[password_confirmation]" type="password" placeholder="confirm password" required>
          <input type="submit" class="col-6 col-lg-2 btn btn-outline-light" value="Sign Up">
        </fieldset>
      </form>
    </div>
    <div class="row">
      <form class="input-group" id="sign-in">
        <fieldset>
          <input class="col-8 col-lg-4 mb-2 credentials" name="credentials[email]" type="email" placeholder="email" required>
          <input class="col-8 col-lg-4 mb-2 credentials" name="credentials[password]" type="password" placeholder="password" required>
          <input type="submit" class="col-6 col-lg-2 btn btn-outline-light" value="Sign In">
        </fieldset>
      </form>
    </div>
  </div>
  <p class="homepage-message"></p>

  <main>
    <p class="favorites-title"></p>
    <div id="favorites-content" class="favorites"></div>

    <!-- Map -->
    <div>
    <input id="pac-input" class="controls" type="text" placeholder="Search Box">
  </div>
    <div id='map'></div>

    <p class="restaurants-title"></p>
    <div id="restaurants-content" class="restaurants"></div>
  </main>

  <footer>
    <div class="footer-buttons" id="footer">
      <div class="container text-center my-5">
        <button class="btn btn-outline-light" id="sign-out">Sign Out</button>
      </div>
      <div class="container text-center my-5">
        <button type="button" class="btn btn-outline-light" id="change-password-button" data-toggle="modal" data-target="#change-password-modal">
          Change Password
        </button>

        <div class="modal fade" id="change-password-modal" tabindex="-1">
          <div class="modal-dialog" role="document">
            <div class="modal-content">
              <div class="modal-header">
                <h4 class="title" id="change-password-modal-label">Change Password</h4>
                <button type="button" class="close" data-dismiss="modal">
                  <span aria-hidden="true">&times;</span>
                </button>
              </div>

              <div>
                <form class="col-12 mb-2 change-password" id="change-password-forms">
                  <fieldset>
                    <input class="passwords" name="passwords[old]" type="password" placeholder="old password" required>
                    <input class="passwords" name="passwords[new]" type="password" placeholder="new password" required>
                    <input class="btn btn-outline-light" type="submit" id="change-password-modal-button" value="Change Password">
                  </fieldset>
                </form>
              </div>

              <div>
                <div class="modal-footer">
                  <p class="change-password-message"></p>
                </div>
              </div>

            </div>
          </div>
        </div>
      </div>
    </div>


  </footer>
  <script>
    function initMap() {
      infoWindow = new google.maps.InfoWindow()
      map = new google.maps.Map(document.getElementById('map'), {
        center: {
          lat: 42.358,
          lng: -71.059
        },
        zoom: 12
      })

      // Create the search box and link it to the input
      const input = document.getElementById('pac-input')
      const searchBox = new google.maps.places.SearchBox(input)
      map.controls[google.maps.ControlPosition.TOP_LEFT].push(input)

      // Limit search results to maps current viewport
      map.addListener('bounds_changed', function() {
        searchBox.setBounds(map.getBounds());
      })

      // Listen for event when the user selects a place and return details
      let markers = []
      searchBox.addListener('places_changed', function() {
            var places = searchBox.getPlaces();

            if (places.length == 0) {
              return;
            }

            // Clear out old markers
            markers.forEach(function(marker) {
              marker.setMap(null)
            })
            markers = []

            // For each place, get the icon, name and location
            const bounds = new google.maps.LatLngBounds();
            places.forEach(function(place) {
              if (!place.geometry) {
                console.log("Returned place contains no geometry");
                return;
              }
              const icon = {
                url: place.icon,
                size: new google.maps.Size(71, 71),
                origin: new google.maps.Point(0, 0),
                anchor: new google.maps.Point(17, 34),
                scaledSize: new google.maps.Size(25, 25)
              };

              // Create marker for each place
              markers.push(new google.maps.Marker({
                map: map,
                icon: icon,
                title: place.name,
                position: place.geometry.location
              }))
              if (place.geometry.viewport) {
                // Only geocodes have viewport.
                bounds.union(place.geometry.viewport);
              } else {
                bounds.extend(place.geometry.location);
              }
            })
            map.fitBounds(bounds);
            // const service = new google.maps.places.PlacesService(map)

            //
            //   google.maps.event.addListener(marker, 'click', function () {
            //     infoWindow.setContent(place.name)
            //     infoWindow.open(map, this)
            //   })
            // }
          })
        }
  </script>
  <!-- Maps -->
  <script type="text/javascript" src="http://maps.googleapis.com/maps/api/js?libraries=places&key=AIzaSyC8-eiMsBGW-FFpstCDSeIwTNwqkQRraKM&callback=initMap">
  </script>
</body>

</html>
